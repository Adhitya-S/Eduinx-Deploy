<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eduinx | Deployability Intelligence</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    colors: {
                        base: {
                            950: '#09090b',
                            900: '#18181b',
                            800: '#27272a',
                        },
                        primary: {
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                        },
                        neural: {
                            400: '#818cf8',
                            500: '#6366f1',
                        }
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                        'scan': 'scan 2s linear infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        scan: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- Icons & Charts -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            background-color: #09090b;
            color: #fafafa;
            overflow-x: hidden;
        }
        
        .bg-dot-pattern {
            background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 24px 24px;
        }

        .glass {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-card {
            background: linear-gradient(180deg, rgba(39, 39, 42, 0.4) 0%, rgba(24, 24, 27, 0.8) 100%);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
        }

        .text-gradient {
            background: linear-gradient(to right, #ffffff, #a1a1aa);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .text-gradient-primary {
            background: linear-gradient(135deg, #34d399, #6366f1);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .mockup-scroll::-webkit-scrollbar { width: 6px; }
        .mockup-scroll::-webkit-scrollbar-track { background: transparent; }
        .mockup-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 6px; }
        .mockup-scroll:hover::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        .checklist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
    </style>
</head>
<body class="antialiased selection:bg-primary-500/30 selection:text-white">

    <!-- Ambient Background Blobs -->
    <div class="fixed top-[-10%] left-[-10%] w-96 h-96 bg-primary-500/20 rounded-full mix-blend-screen filter blur-[100px] animate-blob z-[-1] pointer-events-none"></div>
    <div class="fixed top-[20%] right-[-10%] w-96 h-96 bg-neural-500/20 rounded-full mix-blend-screen filter blur-[100px] animate-blob animation-delay-2000 z-[-1] pointer-events-none"></div>
    <div class="fixed bottom-[-20%] left-[20%] w-96 h-96 bg-primary-600/20 rounded-full mix-blend-screen filter blur-[100px] animate-blob animation-delay-4000 z-[-1] pointer-events-none"></div>
    <div class="fixed inset-0 bg-dot-pattern opacity-50 z-[-2] pointer-events-none"></div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="assets/new_logo_white.png" alt="Eduinx Logo" class="h-10 md:h-12 w-auto object-contain" onerror="this.src='https://via.placeholder.com/150x50?text=Eduinx'">
            </div>
            <div class="hidden md:flex items-center space-x-8 text-sm font-semibold text-gray-400">
                <a href="home.html" class="hover:text-white transition-colors">Home</a>
                <a href="#console" class="hover:text-white transition-colors">Console</a>
                <a href="intelligence.html" class="hover:text-white transition-colors">How It Works</a>
                <a href="#employers" class="hover:text-white transition-colors">Employers</a>
            </div>
            <div class="flex items-center space-x-4">
                <a href="#console" class="px-6 py-2.5 text-sm font-bold bg-white text-base-950 rounded-full hover:bg-gray-200 transition-all shadow-[0_0_20px_rgba(255,255,255,0.2)]">
                    Access Console
                </a>
            </div>
        </div>
    </nav>

    <!-- LIVE PRODUCT CONSOLE (Full Screen Application) -->
    <section id="console" class="pt-28 pb-12 px-4 md:px-6 z-20 relative min-h-screen flex flex-col">
        <div class="max-w-[1600px] mx-auto w-full flex-1 flex flex-col">
            
            <div class="mb-8">
                <h2 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-2">Platform <span class="text-gradient-primary">Console.</span></h2>
                <p class="text-gray-400 text-lg">Five intelligence layers abstracting talent into infrastructure.</p>
            </div>

            <!-- Console Container: Sidebar + Content Layout -->
            <div class="rounded-3xl border border-white/10 bg-base-900/60 backdrop-blur-3xl shadow-[0_0_80px_rgba(0,0,0,0.8)] flex flex-col md:flex-row overflow-hidden flex-1 min-h-[850px]">
                
                <!-- Sidebar Navigation (Mapped to the 5 Layers) -->
                <div class="w-full md:w-72 bg-base-950 border-r border-white/5 p-6 flex flex-col gap-2 shrink-0 overflow-y-auto">
                    <div class="text-xs font-mono text-gray-500 uppercase tracking-widest font-bold mb-4 pl-2">System Architecture</div>
                    
                    <button onclick="switchTab('input')" id="btn-input" class="w-full text-left px-4 py-3.5 rounded-xl transition-all flex items-center gap-3 bg-white/10 text-white font-bold shadow-inner">
                        <i data-lucide="power" class="w-5 h-5 text-primary-400"></i> Setup Matrix
                    </button>
                    
                    <div class="h-px bg-white/5 my-2"></div>
                    
                    <button onclick="switchTab('jd')" id="btn-jd" class="w-full text-left px-4 py-3.5 rounded-xl transition-all flex items-center gap-3 text-gray-600 cursor-not-allowed hidden">
                        <i data-lucide="scan-line" class="w-5 h-5"></i> 1. JD Intelligence
                    </button>
                    
                    <button onclick="switchTab('scoring')" id="btn-scoring" class="w-full text-left px-4 py-3.5 rounded-xl transition-all flex items-center gap-3 text-gray-600 cursor-not-allowed hidden">
                        <i data-lucide="crosshair" class="w-5 h-5"></i> 2. Scoring Engine
                    </button>
                    
                    <button onclick="switchTab('signal')" id="btn-signal" class="w-full text-left px-4 py-3.5 rounded-xl transition-all flex items-center gap-3 text-gray-600 cursor-not-allowed hidden relative group">
                        <i data-lucide="braces" class="w-5 h-5"></i> 3. Signal Generator
                        <span id="mentor-action-dot" class="absolute right-4 w-2.5 h-2.5 bg-primary-400 rounded-full animate-ping hidden"></span>
                    </button>

                    <button onclick="switchTab('matching')" id="btn-matching" class="w-full text-left px-4 py-3.5 rounded-xl transition-all flex items-center gap-3 text-gray-600 cursor-not-allowed hidden">
                        <i data-lucide="git-merge" class="w-5 h-5"></i> 4. Mandate Matching
                    </button>
                    
                    <button onclick="switchTab('visibility')" id="btn-visibility" class="w-full text-left px-4 py-3.5 rounded-xl transition-all flex items-center gap-3 text-gray-600 cursor-not-allowed hidden">
                        <i data-lucide="eye" class="w-5 h-5"></i> 5. Visibility Layer
                    </button>
                </div>

                <!-- Main Content Area -->
                <div class="flex-1 relative bg-base-900/30">
                    
                    <!-- Loading Overlay -->
                    <div id="loading-overlay" class="absolute inset-0 bg-base-950/95 backdrop-blur-xl z-50 flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
                        <div class="relative w-48 h-48 flex items-center justify-center mb-8">
                            <div class="absolute inset-0 border-2 border-dashed border-primary-500/30 rounded-full animate-[spin_4s_linear_infinite]"></div>
                            <div class="absolute inset-4 border border-neural-500/40 rounded-full animate-[spin_3s_linear_infinite_reverse]"></div>
                            <i data-lucide="cpu" class="w-16 h-16 text-primary-400 animate-pulse"></i>
                        </div>
                        <div class="font-mono text-white text-xl tracking-widest uppercase mb-6 text-glow" id="loading-text">Synthesizing Layers...</div>
                        <div class="w-80 h-1.5 bg-base-800 rounded-full overflow-hidden">
                            <div id="loading-bar" class="h-full bg-gradient-to-r from-primary-400 to-neural-500 w-0 transition-all duration-300"></div>
                        </div>
                    </div>

                    <!-- TAB 0: Setup Matrix -->
                    <div id="content-input" class="absolute inset-0 p-8 lg:p-12 flex flex-col xl:flex-row gap-12 opacity-100 z-10 overflow-y-auto mockup-scroll">
                        <!-- JD Box -->
                        <div class="w-full xl:w-1/2 flex flex-col gap-5">
                            <div class="flex justify-between items-center mb-2">
                                <div>
                                    <h3 class="text-2xl font-bold text-white">Target Mandate (JD)</h3>
                                    <p class="text-gray-500 text-sm mt-1">Initialize the JD Intelligence Layer.</p>
                                </div>
                                <button onclick="loadSampleData()" class="px-4 py-2 bg-primary-500/10 hover:bg-primary-500/20 text-primary-400 text-xs font-mono font-bold rounded-lg border border-primary-500/30 transition-all flex items-center gap-2">
                                    <i data-lucide="zap" class="w-4 h-4"></i> Load Demo Data
                                </button>
                            </div>
                            <textarea id="jd-input" class="w-full flex-1 bg-base-950 border border-white/10 rounded-3xl p-8 text-base text-gray-300 font-mono focus:border-primary-500 focus:ring-1 focus:ring-primary-500 focus:outline-none resize-none min-h-[400px] xl:min-h-0 shadow-inner" placeholder="Paste full unstructured job description here..."></textarea>
                        </div>
                        
                        <!-- Upload Box -->
                        <div class="w-full xl:w-1/2 flex flex-col gap-5">
                            <div class="flex justify-between items-center mb-2">
                                <div>
                                    <h3 class="text-2xl font-bold text-white">Candidate Pool</h3>
                                    <p class="text-gray-500 text-sm mt-1">Upload resumes for Deployability Scoring.</p>
                                </div>
                                <span class="px-4 py-1.5 bg-white/5 text-gray-300 font-mono text-sm font-bold rounded-lg border border-white/10" id="cv-count">0 Files</span>
                            </div>
                            
                            <!-- Notice the stopPropagation to prevent double firing -->
                            <div id="drop-zone" class="bg-base-950 border-2 border-dashed border-white/20 rounded-3xl p-12 flex flex-col items-center justify-center text-center hover:border-primary-500/50 hover:bg-white/[0.02] transition-all cursor-pointer group" onclick="document.getElementById('cv-upload').click()">
                                <input type="file" id="cv-upload" class="hidden" accept=".pdf,.txt" multiple onchange="handleFileSelect(event)" onclick="event.stopPropagation()">
                                <div class="w-20 h-20 rounded-3xl bg-white/5 flex items-center justify-center mb-6 group-hover:-translate-y-2 transition-transform duration-300 shadow-xl border border-white/5">
                                    <i data-lucide="upload-cloud" class="w-10 h-10 text-primary-400"></i>
                                </div>
                                <p class="text-xl text-white font-bold mb-2" id="upload-status-text">Drop Resumes Here</p>
                                <p class="text-sm text-gray-500">Supports PDF or TXT.</p>
                            </div>

                            <div id="cv-list" class="flex-1 overflow-y-auto mockup-scroll space-y-4 pb-24">
                                <div class="text-center text-gray-600 text-base mt-10 border border-white/5 border-dashed rounded-2xl p-10 bg-base-950/50" id="empty-cv-state">Awaiting Document Intake...</div>
                            </div>

                            <div class="absolute bottom-10 right-10 z-20">
                                <button onclick="runEngine()" id="btn-run" class="px-10 py-5 bg-white text-base-950 hover:bg-gray-200 font-extrabold text-xl rounded-2xl shadow-[0_10px_40px_rgba(255,255,255,0.2)] transition-all hover:scale-105 active:scale-95 flex items-center gap-4 disabled:opacity-20 disabled:cursor-not-allowed disabled:hover:scale-100" disabled>
                                    Execute All 5 Layers <i data-lucide="play" class="w-6 h-6 fill-current"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 1: JD Intelligence -->
                    <div id="content-jd" class="absolute inset-0 p-8 lg:p-12 opacity-0 pointer-events-none z-0 overflow-y-auto mockup-scroll flex flex-col">
                        <div class="mb-10">
                            <h3 class="text-3xl font-extrabold text-white flex items-center gap-3 mb-2"><i data-lucide="scan-line" class="text-primary-400"></i> Layer 1: JD Intelligence</h3>
                            <p class="text-gray-400 text-lg">Abstracting the unstructured mandate into measurable parameters.</p>
                        </div>

                        <!-- EXPLICIT CHECKLIST -->
                        <div class="bg-base-950 border border-white/10 rounded-2xl p-6 mb-10 shadow-lg">
                            <h4 class="text-xs font-mono text-primary-400 uppercase tracking-widest mb-5">Layer Operations Verified</h4>
                            <div class="checklist-grid">
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Converts job descriptions into execution requirements</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Identifies depth vs surface skill needs</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Detects ambiguity tolerance</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Detects system complexity</span></div>
                            </div>
                        </div>

                        <div id="jd-render-matrix" class="space-y-8 flex-1"></div>
                    </div>

                    <!-- TAB 2: Deployability Scoring -->
                    <div id="content-scoring" class="absolute inset-0 p-8 lg:p-12 opacity-0 pointer-events-none z-0 overflow-y-auto mockup-scroll flex flex-col">
                        <div class="mb-10 flex justify-between items-end">
                            <div>
                                <h3 class="text-3xl font-extrabold text-white flex items-center gap-3 mb-2"><i data-lucide="crosshair" class="text-primary-400"></i> Layer 2: Deployability Scoring Engine</h3>
                                <p class="text-gray-400 text-lg">This is our moat. Benchmarking execution reliability.</p>
                            </div>
                        </div>

                        <!-- EXPLICIT CHECKLIST -->
                        <div class="bg-base-950 border border-white/10 rounded-2xl p-6 mb-10 shadow-lg relative overflow-hidden">
                            <div class="absolute right-0 top-0 bottom-0 w-2 bg-primary-500"></div>
                            <h4 class="text-xs font-mono text-primary-400 uppercase tracking-widest mb-5">Layer Operations Verified (The Moat)</h4>
                            <div class="checklist-grid">
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Industry-rubric aligned benchmarking</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Execution reliability scoring</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Applied sprint simulation validation</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Ambiguity handling index</span></div>
                            </div>
                        </div>

                        <div class="grid lg:grid-cols-2 gap-6" id="scoring-render-matrix">
                            <!-- Dynamic UI populated by JS -->
                        </div>
                    </div>

                    <!-- TAB 3: Signal Packet Generator (Deep Profile + Mentor Score) -->
                    <div id="content-signal" class="absolute inset-0 p-8 lg:p-12 opacity-0 pointer-events-none z-0 overflow-y-auto mockup-scroll flex flex-col">
                        <div class="mb-10">
                            <h3 class="text-3xl font-extrabold text-white flex items-center gap-3 mb-2"><i data-lucide="braces" class="text-primary-400"></i> Layer 3: Signal Packet Generator</h3>
                            <p class="text-gray-400 text-lg">Machine-readable JSON formats and Deep Profiling.</p>
                        </div>

                        <!-- EXPLICIT CHECKLIST -->
                        <div class="bg-base-950 border border-white/10 rounded-2xl p-6 mb-10 shadow-lg">
                            <h4 class="text-xs font-mono text-primary-400 uppercase tracking-widest mb-5">Generated Packet Vectors</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-2">
                                <div class="flex items-center gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-primary-500"></i> <span class="text-sm text-gray-300">Deployability Score</span></div>
                                <div class="flex items-center gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-primary-500"></i> <span class="text-sm text-gray-300">Execution Reliability</span></div>
                                <div class="flex items-center gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-primary-500"></i> <span class="text-sm text-gray-300">System Thinking Index</span></div>
                                <div class="flex items-center gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-primary-500"></i> <span class="text-sm text-gray-300">Domain Depth Index</span></div>
                                <div class="flex items-center gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-primary-500"></i> <span class="text-sm text-gray-300">Portfolio Validation Status</span></div>
                                <div class="flex items-center gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-primary-500"></i> <span class="text-sm text-gray-300 font-bold text-white">Mentor-Validated Status</span></div>
                                <div class="flex items-center gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-primary-500"></i> <span class="text-sm text-gray-300">Machine-readable JSON format</span></div>
                            </div>
                        </div>

                        <!-- Deep Profile Layout -->
                        <div class="flex flex-col xl:flex-row gap-8">
                            <!-- Left Panel: Info & Mentor Score Input -->
                            <div class="w-full xl:w-5/12 flex flex-col gap-6" id="profile-left">
                                <div class="text-gray-500 text-center mt-10 p-10 border border-white/5 border-dashed rounded-2xl">
                                    Process complete. Please select a candidate from Mandate Matching to view.
                                </div>
                            </div>

                            <!-- Right Panel: Graphs & JSON -->
                            <div class="w-full xl:w-7/12 flex flex-col gap-6" id="profile-right" style="display: none;">
                                <!-- JSON Toggle View -->
                                <div class="bg-base-950 border border-white/5 rounded-3xl p-6 shadow-lg h-full flex flex-col">
                                    <div class="flex justify-between items-center mb-6">
                                        <h4 class="text-base font-bold text-white flex items-center gap-2">
                                            <i data-lucide="radar" class="text-primary-400"></i> Intelligence Vectors
                                        </h4>
                                        <div class="flex bg-white/5 p-1 rounded-lg">
                                            <button onclick="toggleSignalView('graph')" id="btn-view-graph" class="px-4 py-1.5 text-xs font-bold rounded bg-white/10 text-white transition-all">Visual</button>
                                            <button onclick="toggleSignalView('json')" id="btn-view-json" class="px-4 py-1.5 text-xs font-bold rounded text-gray-500 transition-all">Raw JSON</button>
                                        </div>
                                    </div>
                                    
                                    <!-- Graph View -->
                                    <div id="view-graph" class="flex-1 flex flex-col lg:flex-row items-center gap-8">
                                        <div class="w-full lg:w-1/2 aspect-square max-w-[350px] relative">
                                            <canvas id="skillsRadarChart"></canvas>
                                        </div>
                                        <div class="w-full lg:w-1/2 flex flex-col justify-center gap-6" id="profile-bars"></div>
                                    </div>

                                    <!-- JSON View -->
                                    <div id="view-json" class="flex-1 hidden bg-black rounded-xl border border-white/5 p-6 overflow-auto mockup-scroll">
                                        <pre id="json-code-block" class="text-[11px] font-mono text-primary-400 leading-relaxed m-0"></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 4: Mandate Matching Engine -->
                    <div id="content-matching" class="absolute inset-0 p-8 lg:p-12 opacity-0 pointer-events-none z-0 overflow-y-auto mockup-scroll flex flex-col">
                        <div class="mb-10">
                            <h3 class="text-3xl font-extrabold text-white flex items-center gap-3 mb-2"><i data-lucide="git-merge" class="text-primary-400"></i> Layer 4: Mandate Matching Engine</h3>
                            <p class="text-gray-400 text-lg">Routing validated signals to active roles.</p>
                        </div>

                        <!-- EXPLICIT CHECKLIST -->
                        <div class="bg-base-950 border border-white/10 rounded-2xl p-6 mb-10 shadow-lg">
                            <h4 class="text-xs font-mono text-primary-400 uppercase tracking-widest mb-5">Layer Operations Verified</h4>
                            <div class="checklist-grid">
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Role pathway routing</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Weighted signal ranking</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Conversion probability estimation</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Interview readiness heatmap</span></div>
                            </div>
                        </div>

                        <div class="bg-base-950 rounded-3xl border border-white/5 overflow-hidden shadow-2xl flex-1 flex flex-col">
                            <table class="w-full text-left text-sm">
                                <thead class="bg-white/5 border-b border-white/5 text-gray-400 font-mono uppercase tracking-wider text-xs">
                                    <tr>
                                        <th class="px-8 py-5">Candidate Route</th>
                                        <th class="px-8 py-5">Weighted Signal</th>
                                        <th class="px-8 py-5">Interview Heatmap</th>
                                        <th class="px-8 py-5 text-right">View Packet</th>
                                    </tr>
                                </thead>
                                <tbody id="table-ranked-pool" class="divide-y divide-white/5"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- TAB 5: Hiring Visibility Layer -->
                    <div id="content-visibility" class="absolute inset-0 p-8 lg:p-12 opacity-0 pointer-events-none z-0 overflow-y-auto mockup-scroll flex flex-col">
                        <div class="mb-10">
                            <h3 class="text-3xl font-extrabold text-white flex items-center gap-3 mb-2"><i data-lucide="eye" class="text-primary-400"></i> Layer 5: Hiring Visibility Layer</h3>
                            <p class="text-gray-400 text-lg">The enterprise recruiter dashboard. Zero noise.</p>
                        </div>

                        <!-- EXPLICIT CHECKLIST -->
                        <div class="bg-base-950 border border-white/10 rounded-2xl p-6 mb-10 shadow-lg">
                            <h4 class="text-xs font-mono text-primary-400 uppercase tracking-widest mb-5">Layer Operations Verified</h4>
                            <div class="checklist-grid">
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Recruiter dashboard initialized</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Pre-validated pool access</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Resume noise completely bypassed</span></div>
                                <div class="flex items-center gap-3"><i data-lucide="check-circle-2" class="w-5 h-5 text-primary-500"></i> <span class="text-sm text-gray-200 font-medium">Signal-first ranking</span></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10" id="analytics-top"></div>
                        <div class="bg-base-950 border border-white/5 rounded-3xl p-10 shadow-2xl flex-1">
                            <h4 class="text-xl font-bold text-white mb-8 border-b border-white/5 pb-4">Engine Rationale Logs</h4>
                            <div class="space-y-5" id="analytics-rationale"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <!-- 5. FLYWHEEL -->
    <section id="flywheel" class="py-32 px-6 border-t border-white/5 bg-base-950 relative overflow-hidden">
        <div class="max-w-5xl mx-auto text-center relative z-10">
            <h2 class="text-4xl md:text-5xl font-extrabold mb-16">Signal Trust <span class="text-gradient-primary">Compounds.</span></h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="glass-card p-10 rounded-3xl">
                    <div class="text-6xl font-extrabold text-white mb-2">85</div>
                    <div class="text-sm text-gray-500 font-mono uppercase tracking-widest font-bold">Mandates Tracked</div>
                </div>
                <div class="glass-card p-10 rounded-3xl border-primary-500/30 relative overflow-hidden shadow-[0_0_30px_rgba(16,185,129,0.1)] scale-105">
                    <div class="absolute inset-0 bg-primary-500/10"></div>
                    <div class="text-6xl font-extrabold text-primary-400 mb-2 relative z-10 text-glow">78%</div>
                    <div class="text-sm text-primary-400/80 font-mono uppercase tracking-widest font-bold relative z-10">Execution Reliability</div>
                </div>
                <div class="glass-card p-10 rounded-3xl">
                    <div class="text-6xl font-extrabold text-white mb-2">65%</div>
                    <div class="text-sm text-gray-500 font-mono uppercase tracking-widest font-bold">Deployability Pass</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="border-t border-white/5 bg-base-950 pt-16 pb-8 px-6 relative z-10">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-12 mb-16">
            <div class="col-span-1 md:col-span-2">
                <div class="flex items-center gap-3 mb-6">
                    <img src="assets/new_logo_white.png" alt="Eduinx Logo" class="h-10 w-auto object-contain">
                </div>
                <p class="text-gray-500 max-w-sm mb-6">Abstracting talent into measurable, reliable infrastructure. Stop guessing, start deploying.</p>
                <div class="flex gap-4">
                    <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/10 transition-colors"><i data-lucide="twitter" class="w-5 h-5"></i></a>
                    <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/10 transition-colors"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
                    <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/10 transition-colors"><i data-lucide="github" class="w-5 h-5"></i></a>
                </div>
            </div>
            
            <div>
                <h4 class="text-white font-bold mb-6">Platform</h4>
                <ul class="space-y-4 text-gray-400 text-sm">
                    <li><a href="#console" class="hover:text-primary-400 transition-colors">Workspace Console</a></li>
                    <li><a href="#how-it-works" class="hover:text-primary-400 transition-colors">How It Works</a></li>
                    <li><a href="#" class="hover:text-primary-400 transition-colors">Scoring Rubrics</a></li>
                    <li><a href="#" class="hover:text-primary-400 transition-colors">API Access</a></li>
                </ul>
            </div>
            
            <div>
                <h4 class="text-white font-bold mb-6">Company</h4>
                <ul class="space-y-4 text-gray-400 text-sm">
                    <li><a href="#" class="hover:text-primary-400 transition-colors">About Us</a></li>
                    <li><a href="#" class="hover:text-primary-400 transition-colors">Case Studies</a></li>
                    <li><a href="#" class="hover:text-primary-400 transition-colors">Privacy Policy</a></li>
                    <li><a href="#" class="hover:text-primary-400 transition-colors">Terms of Service</a></li>
                </ul>
            </div>
        </div>
        
        <div class="max-w-7xl mx-auto border-t border-white/5 pt-8 flex flex-col md:flex-row items-center justify-between text-gray-600 text-sm">
            <p>&copy; 2026 Eduinx Intelligence. All rights reserved.</p>
            <p class="flex items-center gap-2 mt-4 md:mt-0">Built for scale <i data-lucide="zap" class="w-4 h-4 text-primary-500"></i></p>
        </div>
    </footer>

    <!-- App Logic -->
    <script>
        lucide.createIcons();
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const openRouterKey = "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"; 

        const state = {
            candidates: [],
            analysisData: null,
            activeProfileId: null
        };

        const jdInput = document.getElementById('jd-input');
        const cvList = document.getElementById('cv-list');
        const cvCount = document.getElementById('cv-count');
        const btnRun = document.getElementById('btn-run');
        const emptyState = document.getElementById('empty-cv-state');
        const dropZone = document.getElementById('drop-zone');
        const uploadStatusText = document.getElementById('upload-status-text');

        let radarChartInstance = null;

        // --- 1. SETUP LOGIC ---
        async function extractTextFromPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = "";
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(" ");
                fullText += pageText + " ";
            }
            return fullText;
        }

        async function handleFileSelect(event) {
            const files = event.target.files;
            if(!files || files.length === 0) return;

            dropZone.classList.add('opacity-50', 'pointer-events-none');
            uploadStatusText.innerText = "Extracting...";

            for (let file of files) {
                const nameStr = file.name.replace(/\.[^/.]+$/, "").replace(/[-_]/g, " ");
                const cleanName = nameStr.replace(/\b\w/g, l => l.toUpperCase());
                const id = 'EDX-' + Math.floor(100 + Math.random() * 900);
                
                let extractedText = "";
                try {
                    if (file.type === "application/pdf" || file.name.endsWith('.pdf')) {
                        extractedText = await extractTextFromPDF(file);
                    } else if (file.type === "text/plain" || file.name.endsWith('.txt')) {
                        extractedText = await file.text();
                    } else {
                        extractedText = `[Simulated parse] Candidate: ${cleanName}. Has relevant background.`;
                    }
                } catch(e) { extractedText = `[Error] ${cleanName}.`; }

                if(extractedText.length > 5000) extractedText = extractedText.substring(0, 5000);

                state.candidates.push({ id, name: cleanName, text: extractedText, fileName: file.name });
            }
            
            dropZone.classList.remove('opacity-50', 'pointer-events-none');
            uploadStatusText.innerText = "Drop Resumes Here";
            updateCVList();
            checkRunReady();
            event.target.value = ''; 
        }

        function removeCandidate(index) {
            state.candidates.splice(index, 1);
            updateCVList();
            checkRunReady();
        }

        function updateCVList() {
            if(state.candidates.length === 0) {
                emptyState.style.display = 'block';
                cvList.innerHTML = '';
            } else {
                emptyState.style.display = 'none';
                cvList.innerHTML = state.candidates.map((c, i) => `
                    <div class="bg-base-950 border border-white/5 rounded-2xl p-5 flex items-center justify-between group shadow-sm">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl bg-primary-500/10 text-primary-400 flex items-center justify-center">
                                <i data-lucide="file-text" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-white font-bold text-base">${c.fileName}</div>
                                <div class="text-xs text-gray-500 font-mono mt-1">ID: ${c.id}</div>
                            </div>
                        </div>
                        <button onclick="removeCandidate(${i})" class="text-gray-500 hover:text-red-400 p-3 bg-black rounded-lg transition-colors">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                `).join('');
                lucide.createIcons();
            }
            cvCount.innerText = `${state.candidates.length} Files`;
        }

        function checkRunReady() {
            if(jdInput.value.trim().length > 10 && state.candidates.length > 0) {
                btnRun.removeAttribute('disabled');
            } else {
                btnRun.setAttribute('disabled', 'true');
            }
        }
        jdInput.addEventListener('input', checkRunReady);

        function loadSampleData() {
            jdInput.value = `Role: GenAI Engineer\n- 2+ years experience building production LLM apps.\n- Python, RAG pipelines, Pinecone/Milvus.\n- Architect cloud deployments (AWS/GCP).\n- High ambiguity tolerance required.`;

            state.candidates = [
                { id: 'EDX-412', name: "Alice Wang", fileName: "Alice_Wang_Resume.pdf", text: "Senior Software Engineer. Python expert with 4 years experience. Built a custom RAG pipeline using LlamaIndex and deployed on AWS. Navigates ambiguity well." },
                { id: 'EDX-881', name: "Bob Smith", fileName: "Bob_Smith_CV.pdf", text: "Junior Developer. Knows basic Python. No deployment experience. Needs strict guidance." },
                { id: 'EDX-094', name: "Charlie Davis", fileName: "Charlie_Davis.pdf", text: "Cloud Architect. 5 years AWS. Designed complex systems. Learning LLMs. Good system thinker." }
            ];
            updateCVList();
            checkRunReady();
        }

        // --- 2. SIDEBAR TAB LOGIC ---
        const tabs = ['input', 'jd', 'scoring', 'signal', 'matching', 'visibility'];
        function switchTab(tabId) {
            tabs.forEach(id => {
                const contentEl = document.getElementById(`content-${id}`);
                const btnEl = document.getElementById(`btn-${id}`);
                if(!btnEl || !contentEl) return;
                
                if (id === tabId) {
                    contentEl.classList.remove('opacity-0', 'pointer-events-none', 'z-0');
                    contentEl.classList.add('opacity-100', 'z-10');
                    btnEl.classList.remove('text-gray-600', 'bg-transparent', 'hover:bg-white/5');
                    btnEl.classList.add('bg-white/10', 'text-white', 'shadow-inner');
                } else {
                    contentEl.classList.add('opacity-0', 'pointer-events-none', 'z-0');
                    contentEl.classList.remove('opacity-100', 'z-10');
                    btnEl.classList.remove('bg-white/10', 'text-white', 'shadow-inner');
                    
                    if(state.analysisData || id === 'input') {
                        btnEl.classList.remove('cursor-not-allowed', 'text-gray-600');
                        btnEl.classList.add('text-gray-400', 'hover:bg-white/5');
                    }
                }
            });
            // Auto update downstream tabs in case mentor scores changed
            if(tabId === 'matching') renderRankedPool(); 
            if(tabId === 'visibility') renderAnalytics(); 
        }

        function toggleSignalView(view) {
            const btnGraph = document.getElementById('btn-view-graph');
            const btnJson = document.getElementById('btn-view-json');
            const viewGraph = document.getElementById('view-graph');
            const viewJson = document.getElementById('view-json');

            if(view === 'graph') {
                viewGraph.classList.remove('hidden'); viewGraph.classList.add('flex');
                viewJson.classList.add('hidden');
                btnGraph.classList.add('bg-white/10', 'text-white'); btnGraph.classList.remove('text-gray-500');
                btnJson.classList.remove('bg-white/10', 'text-white'); btnJson.classList.add('text-gray-500');
            } else {
                viewGraph.classList.add('hidden'); viewGraph.classList.remove('flex');
                viewJson.classList.remove('hidden');
                btnJson.classList.add('bg-white/10', 'text-white'); btnJson.classList.remove('text-gray-500');
                btnGraph.classList.remove('bg-white/10', 'text-white'); btnGraph.classList.add('text-gray-500');
            }
        }

        // --- 3. AI ENGINE EXECUTION ---
        async function runEngine() {
            const overlay = document.getElementById('loading-overlay');
            const lText = document.getElementById('loading-text');
            const lBar = document.getElementById('loading-bar');
            
            overlay.classList.remove('opacity-0', 'pointer-events-none');
            
            setTimeout(() => { lBar.style.width = '20%'; lText.innerText = "Parsing Mandate Vector..."; }, 200);
            setTimeout(() => { lBar.style.width = '50%'; lText.innerText = "Extracting Capabilities..."; }, 600);
            setTimeout(() => { lBar.style.width = '80%'; lText.innerText = "Benchmarking vs Rubrics..."; }, 1000);

            try {
                const response = await fetchOpenRouter();
                response.candidates.forEach(c => c.mentor_score = null); // initialize
                state.analysisData = response;
                
                populateAllLayers();
                
                lBar.style.width = '100%';
                lText.innerText = "Matrix Initialized.";
                
                setTimeout(() => {
                    overlay.classList.add('opacity-0', 'pointer-events-none');
                    tabs.forEach(id => {
                        const btn = document.getElementById(`btn-${id}`);
                        if(btn) { btn.classList.remove('hidden', 'cursor-not-allowed'); btn.classList.add('hover:bg-white/5'); }
                    });
                    switchTab('jd');
                }, 400); 

            } catch (err) {
                console.error("AI Error:", err);
                state.analysisData = getMockFallbackData();
                populateAllLayers();
                
                lBar.style.width = '100%';
                lText.innerText = "Using Local Computation Matrix.";
                setTimeout(() => {
                    overlay.classList.add('opacity-0', 'pointer-events-none');
                    tabs.forEach(id => {
                        const btn = document.getElementById(`btn-${id}`);
                        if(btn) { btn.classList.remove('hidden', 'cursor-not-allowed'); btn.classList.add('hover:bg-white/5'); }
                    });
                    switchTab('jd');
                }, 400);
            }
        }

        async function fetchOpenRouter() {
            const prompt = `Evaluate the candidates' REAL uploaded resume text against the Job Description. Be mathematically accurate based on overlap.
            
            JD: """${jdInput.value}"""
            
            Candidates:
            ${state.candidates.map(c => `[ID: ${c.id}, Name: ${c.name}, Resume_Text: ${c.text}]`).join('\n')}
            
            Rules for Accurate Scoring:
            - ai_confidence_score is 0-100 based PURELY on actual resume fit against the JD.
            - execution_reliability: High, Medium, or Low.
            - indices: system_thinking, ambiguity_handling, domain_depth MUST be floats between 0.0 and 1.0.
            - Extract precise jd_analysis metrics.
            
            Output ONLY raw JSON matching this structure exactly:
            {
                "jd_analysis": { "core_domain": "string", "surface_skills": ["string"], "depth_skills": ["string"], "system_complexity": "string" },
                "candidates": [
                    { "id": "string", "name": "string", "ai_confidence_score": 90, "execution_reliability": "string", "indices": { "system_thinking": 0.9, "ambiguity_handling": 0.8, "domain_depth": 0.9 }, "verified_stack": ["string"], "portfolio_validation_status": true, "rationale": "string" }
                ]
            }`;

            const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${openRouterKey}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "stepfun/step-3.5-flash:free",
                    messages: [ { role: "system", content: "You strictly output raw JSON only." }, { role: "user", content: prompt } ]
                })
            });
            
            if (!res.ok) throw new Error("API Connection Error");
            const data = await res.json();
            
            if(!data || !data.choices || !data.choices[0] || !data.choices[0].message) {
                throw new Error("Invalid API Response");
            }
            
            let content = data.choices[0].message.content;
            
            const jsonMatch = content.match(/\{[\s\S]*\}/);
            if (jsonMatch) {
                content = jsonMatch[0];
            } else {
                throw new Error("Could not extract JSON block");
            }

            const parsedData = JSON.parse(content);

            const safeData = {
                jd_analysis: parsedData.jd_analysis || { core_domain: "General", surface_skills: [], depth_skills: [], system_complexity: "Medium" },
                candidates: state.candidates.map(origC => {
                    const aiC = parsedData.candidates?.find(c => c.id === origC.id) || {};
                    
                    let aiScore = aiC.ai_confidence_score || 50;
                    if (aiScore <= 1 && aiScore > 0) aiScore = Math.round(aiScore * 100); 

                    let sys = aiC.indices?.system_thinking || 0.5;
                    let amb = aiC.indices?.ambiguity_handling || 0.5;
                    let dom = aiC.indices?.domain_depth || 0.5;
                    if (sys > 1) sys = sys / 100;
                    if (amb > 1) amb = amb / 100;
                    if (dom > 1) dom = dom / 100;

                    return {
                        id: origC.id,
                        name: origC.name,
                        ai_confidence_score: aiScore,
                        execution_reliability: aiC.execution_reliability || "Medium",
                        indices: { system_thinking: sys, ambiguity_handling: amb, domain_depth: dom },
                        verified_stack: aiC.verified_stack || [],
                        portfolio_validation_status: aiC.portfolio_validation_status || false,
                        rationale: aiC.rationale || "Score computed successfully against mandate."
                    };
                })
            };

            return safeData;
        }

        // Fortified fallback engine
        function getMockFallbackData() {
            const jdText = jdInput.value.toLowerCase();
            const keywords = jdText.match(/\b\w{4,}\b/g) || ["experience", "developer", "engineer"];
            const uniqueKeywords = [...new Set(keywords)];

            return {
                jd_analysis: { core_domain: "Extracted Target Profile", surface_skills: ["Analysis Pending"], depth_skills: ["System Processing"], system_complexity: "Dynamic" },
                candidates: state.candidates.map((c) => {
                    const candText = c.text.toLowerCase();
                    let matchCount = 0;
                    uniqueKeywords.forEach(kw => { if(candText.includes(kw)) matchCount++; });
                    
                    let score = Math.round((matchCount / uniqueKeywords.length) * 100);
                    score = Math.min(100, score + 30); 

                    return {
                        id: c.id, 
                        name: c.name, 
                        ai_confidence_score: score, 
                        mentor_score: null,
                        execution_reliability: score >= 80 ? "High" : (score >= 60 ? "Medium" : "Low"),
                        indices: { system_thinking: score/100, ambiguity_handling: Math.max(0, score-10)/100, domain_depth: score/100 },
                        verified_stack: ["Computed locally via overlap"], 
                        portfolio_validation_status: score >= 75,
                        rationale: `Computed match score (${score}%) based on semantic overlap due to API timeout.`
                    };
                })
            };
        }

        function getFinalScore(candidate) {
            if(candidate.mentor_score === null || candidate.mentor_score === "" || isNaN(candidate.mentor_score)) return candidate.ai_confidence_score;
            return Math.round((candidate.ai_confidence_score * 0.4) + (candidate.mentor_score * 0.6));
        }

        function populateAllLayers() {
            renderJDIntelligence();
            renderScoringEngine();
            renderRankedPool(); 
            renderAnalytics(); 
        }

        // --- 4. RENDER LOGIC PER LAYER ---

        // LAYER 1: JD Intelligence
        function renderJDIntelligence() {
            const jd = state.analysisData.jd_analysis;
            document.getElementById('jd-render-matrix').innerHTML = `
                <div class="bg-base-950 border border-white/5 rounded-3xl p-10 mb-8 relative overflow-hidden shadow-2xl">
                    <div class="absolute right-0 top-0 w-64 h-64 bg-neural-500/10 blur-[80px]"></div>
                    <div class="text-neural-400 text-sm font-mono uppercase tracking-widest font-bold mb-3 relative z-10">Core Domain Focus</div>
                    <div class="text-5xl font-extrabold text-white mb-8 relative z-10">${jd.core_domain}</div>
                    <div class="text-gray-500 text-sm font-mono uppercase tracking-widest font-bold mb-3 relative z-10">System Complexity Detected</div>
                    <div class="text-2xl text-white font-bold relative z-10 flex items-center gap-3"><i data-lucide="activity" class="text-primary-400"></i> ${jd.system_complexity}</div>
                </div>
                <div class="grid xl:grid-cols-2 gap-8">
                    <div class="bg-base-950 border border-white/5 rounded-3xl p-10 shadow-lg">
                        <h4 class="text-base font-bold text-gray-400 uppercase tracking-widest mb-8 flex items-center gap-3"><i data-lucide="layers" class="w-6 h-6"></i> Surface Skills Required</h4>
                        <div class="flex flex-wrap gap-3">
                            ${(jd.surface_skills || []).map(s => `<span class="px-4 py-2 bg-white/5 text-gray-200 text-base font-medium rounded-xl border border-white/10">${s}</span>`).join('')}
                        </div>
                    </div>
                    <div class="bg-base-950 border border-primary-500/30 rounded-3xl p-10 shadow-[inset_0_0_30px_rgba(16,185,129,0.05)] relative">
                        <div class="absolute top-0 right-0 px-4 py-1.5 bg-primary-500/20 text-primary-400 text-xs font-bold uppercase rounded-bl-xl border-b border-l border-primary-500/20">The Moat</div>
                        <h4 class="text-base font-bold text-primary-400 uppercase tracking-widest mb-8 flex items-center gap-3"><i data-lucide="anchor" class="w-6 h-6"></i> Depth Requirements</h4>
                        <div class="flex flex-col gap-4">
                            ${(jd.depth_skills || []).map(s => `
                                <div class="flex items-center gap-4 bg-black/60 p-4 rounded-xl border border-white/5 shadow-inner">
                                    <i data-lucide="shield-check" class="text-primary-400 w-6 h-6 shrink-0"></i>
                                    <span class="text-white text-lg font-bold">${s}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // LAYER 2: Deployability Scoring Engine
        function renderScoringEngine() {
            const pool = state.analysisData.candidates;
            
            let html = pool.map(c => {
                const passSprint = c.ai_confidence_score >= 70;
                return `
                <div class="bg-base-950 border border-white/10 rounded-3xl p-8 flex flex-col justify-between shadow-xl relative overflow-hidden group">
                    <div class="absolute inset-0 bg-primary-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <div class="relative z-10 mb-6 border-b border-white/5 pb-6">
                        <h4 class="text-2xl font-bold text-white mb-1">${c.name}</h4>
                        <div class="text-sm text-gray-500 font-mono">${c.id}</div>
                    </div>
                    
                    <div class="space-y-5 relative z-10 flex-1">
                        <div>
                            <div class="flex justify-between text-xs font-bold uppercase tracking-wider text-gray-400 mb-2">
                                <span>Rubric Benchmark</span> <span class="text-white">${c.ai_confidence_score}/100</span>
                            </div>
                            <div class="w-full bg-base-800 rounded-full h-2"><div class="bg-neural-400 h-2 rounded-full" style="width: ${c.ai_confidence_score}%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs font-bold uppercase tracking-wider text-gray-400 mb-2">
                                <span>Ambiguity Index</span> <span class="text-white">${Math.round(c.indices.ambiguity_handling * 100)}%</span>
                            </div>
                            <div class="w-full bg-base-800 rounded-full h-2"><div class="bg-primary-400 h-2 rounded-full" style="width: ${c.indices.ambiguity_handling * 100}%"></div></div>
                        </div>
                        <div class="flex justify-between items-center bg-black/50 p-3 rounded-lg border border-white/5 mt-4">
                            <span class="text-xs font-bold uppercase tracking-wider text-gray-400">Execution Rel.</span>
                            <span class="text-sm font-bold ${c.execution_reliability === 'High' ? 'text-primary-400' : 'text-yellow-400'}">${c.execution_reliability}</span>
                        </div>
                        <div class="flex justify-between items-center bg-black/50 p-3 rounded-lg border border-white/5">
                            <span class="text-xs font-bold uppercase tracking-wider text-gray-400">Sprint Simulation</span>
                            <span class="text-sm font-bold ${passSprint ? 'text-primary-400' : 'text-red-400'}">${passSprint ? 'Passed' : 'Failed'}</span>
                        </div>
                    </div>
                </div>
            `}).join('');
            
            document.getElementById('scoring-render-matrix').innerHTML = html;
        }

        // LAYER 4: Mandate Matching
        function renderRankedPool() {
            const sorted = [...state.analysisData.candidates].sort((a,b) => getFinalScore(b) - getFinalScore(a));
            document.getElementById('table-ranked-pool').innerHTML = sorted.map((c, i) => {
                const finalScore = getFinalScore(c);
                const isVal = c.mentor_score !== null && c.mentor_score !== "";
                const heatmapColor = finalScore >= 85 ? 'bg-primary-500' : (finalScore >= 70 ? 'bg-yellow-500' : 'bg-red-500');
                
                return `
                <tr class="hover:bg-white/[0.03] transition-colors cursor-pointer group" onclick="viewProfile('${c.id}')">
                    <td class="px-8 py-6">
                        <div class="font-bold text-white text-xl">${c.name}</div>
                        <div class="text-xs font-mono text-gray-500 mt-2 flex items-center gap-2">
                            <span class="w-5 h-5 rounded-full bg-base-800 flex items-center justify-center text-[10px] text-white font-bold">R${i+1}</span>
                            Routed via ${jdInput.value.substring(0, 15)}...
                        </div>
                    </td>
                    <td class="px-8 py-6">
                        <div class="text-3xl text-white font-extrabold ${isVal ? 'text-glow text-primary-400' : ''}">${finalScore}</div>
                        <div class="text-[10px] uppercase font-bold text-gray-500 mt-1">${isVal ? 'Weighted (Mentor+AI)' : 'AI Base Estimate'}</div>
                    </td>
                    <td class="px-8 py-6">
                        <div class="flex items-center gap-3">
                            <div class="flex gap-1">
                                <div class="w-3 h-8 rounded-sm ${heatmapColor} opacity-20"></div>
                                <div class="w-3 h-8 rounded-sm ${heatmapColor} opacity-50"></div>
                                <div class="w-3 h-8 rounded-sm ${heatmapColor} ${finalScore >= 70 ? 'opacity-100' : 'opacity-20'}"></div>
                                <div class="w-3 h-8 rounded-sm ${heatmapColor} ${finalScore >= 85 ? 'opacity-100 shadow-[0_0_10px_currentColor]' : 'opacity-20'}"></div>
                            </div>
                            <span class="text-sm font-bold text-white ml-2">${finalScore >= 85 ? 'High' : (finalScore >= 70 ? 'Med' : 'Low')}</span>
                        </div>
                    </td>
                    <td class="px-8 py-6 text-right">
                        <button class="px-5 py-2.5 bg-white/10 text-white text-sm font-bold rounded-xl group-hover:bg-white group-hover:text-black transition-all shadow-md">
                            View Deep Profile
                        </button>
                    </td>
                </tr>
            `}).join('');
            lucide.createIcons();
        }

        // LAYER 3: Signal Packet (Deep Profile + Mentor Score)
        function viewProfile(id) {
            switchTab('signal');
            state.activeProfileId = id;
            document.getElementById('profile-right').style.display = 'flex';
            renderActiveProfile();
        }

        // Bugfix: Focus loss during input update - isolated DOM updates
        function handleMentorScoreInput(inputEl) {
            if(!state.activeProfileId) return;
            const c = state.analysisData.candidates.find(x => x.id === state.activeProfileId);
            if(!c) return;

            let val = inputEl.value;
            let s = parseInt(val);
            c.mentor_score = (isNaN(s) || val === "") ? null : Math.max(0, Math.min(100, s));
            
            const finalScore = getFinalScore(c);
            const isVal = c.mentor_score !== null;

            // Update purely the UI components (Right side)
            renderProfileRightPanel(c, finalScore, isVal);
            
            // Update UI status tags directly without touching the input DOM element
            const statusBadge = document.getElementById('mentor-status-badge');
            if (statusBadge) {
                statusBadge.className = `px-3 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider ${isVal ? 'bg-primary-500 text-base-950' : 'bg-white/10 text-gray-400'} transition-all shadow-sm`;
                statusBadge.innerText = isVal ? 'Locked' : 'Pending';
            }

            const panelWrap = document.getElementById('mentor-panel-wrap');
            if (panelWrap) {
                panelWrap.className = `bg-base-950 p-10 rounded-3xl border ${isVal ? 'border-primary-500/40 shadow-[0_0_40px_rgba(16,185,129,0.15)]' : 'border-white/10 border-dashed'} relative overflow-hidden transition-all duration-300`;
            }

            inputEl.className = `w-28 bg-black border-2 ${isVal ? 'border-primary-500/50 text-glow shadow-[0_0_20px_rgba(16,185,129,0.2)]' : 'border-white/10'} text-white font-extrabold text-4xl rounded-2xl px-4 py-4 text-center focus:border-primary-400 focus:outline-none focus:ring-4 focus:ring-primary-500/20 transition-all placeholder-gray-800`;

            document.getElementById('mentor-action-dot').classList.remove('hidden');
        }

        function renderActiveProfile() {
            const c = state.analysisData.candidates.find(x => x.id === state.activeProfileId);
            if(!c) return;

            const finalScore = getFinalScore(c);
            const isVal = c.mentor_score !== null;
            
            document.getElementById('profile-left').innerHTML = `
                <div class="bg-base-950 p-10 rounded-3xl border border-white/5 shadow-xl relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-32 h-32 bg-neural-500/10 blur-[50px]"></div>
                    <div class="flex items-center gap-6 border-b border-white/5 pb-8 mb-8 relative z-10">
                        <div class="w-20 h-20 rounded-2xl bg-gradient-to-tr from-primary-600 to-neural-600 flex items-center justify-center text-white font-bold text-3xl shadow-inner">
                            ${c.name.charAt(0)}
                        </div>
                        <div>
                            <h3 class="font-bold text-white text-3xl mb-1">${c.name}</h3>
                            <div class="font-mono text-gray-500 text-sm">${c.id}</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-8 relative z-10">
                        <div class="bg-black/50 p-5 rounded-2xl border border-white/5">
                            <div class="text-xs text-gray-500 uppercase tracking-widest font-bold mb-2">AI Extraction</div>
                            <div class="text-4xl font-light text-gray-300">${c.ai_confidence_score}</div>
                        </div>
                        <div class="bg-black/50 p-5 rounded-2xl border border-white/5">
                            <div class="text-xs text-gray-500 uppercase tracking-widest font-bold mb-2">Execution</div>
                            <div class="text-2xl font-bold ${c.execution_reliability === 'High' ? 'text-primary-400' : 'text-white'} mt-2">${c.execution_reliability}</div>
                        </div>
                    </div>

                    <div class="mb-4 relative z-10">
                        <div class="text-xs text-gray-500 uppercase tracking-widest font-bold mb-3">Portfolio Validation Status</div>
                        <div class="flex items-center gap-3 bg-black/30 p-3 rounded-xl border border-white/5 w-max">
                            ${c.portfolio_validation_status ? '<i data-lucide="shield-check" class="text-primary-400 w-5 h-5"></i><span class="text-sm font-bold text-primary-400">Validated Intact</span>' : '<i data-lucide="shield-alert" class="text-yellow-500 w-5 h-5"></i><span class="text-sm font-bold text-yellow-500">Requires Audit</span>'}
                        </div>
                    </div>
                </div>

                <!-- THE MENTOR INPUT PANEL -->
                <div id="mentor-panel-wrap" class="bg-base-950 p-10 rounded-3xl border ${isVal ? 'border-primary-500/40 shadow-[0_0_40px_rgba(16,185,129,0.15)]' : 'border-white/10 border-dashed'} relative overflow-hidden transition-all duration-300">
                    <div class="absolute -right-4 -bottom-4 opacity-5"><i data-lucide="fingerprint" class="w-48 h-48 text-primary-400"></i></div>
                    
                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-8">
                            <h4 class="text-sm font-bold text-primary-400 uppercase tracking-widest flex items-center gap-3">
                                <i data-lucide="user-check" class="w-5 h-5"></i> Mentor-Validated Status
                            </h4>
                            <span id="mentor-status-badge" class="px-3 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider ${isVal ? 'bg-primary-500 text-base-950' : 'bg-white/10 text-gray-400'} transition-all shadow-sm">
                                ${isVal ? 'Locked' : 'Pending'}
                            </span>
                        </div>
                        
                        <div class="flex flex-col gap-5 mb-8">
                            <label class="text-base font-medium text-gray-300">Input Expert Mentor Score (0-100)</label>
                            <div class="flex items-center gap-6">
                                <input type="number" min="0" max="100" placeholder="-" value="${c.mentor_score || ''}"
                                    class="w-28 bg-black border-2 ${isVal ? 'border-primary-500/50 text-glow shadow-[0_0_20px_rgba(16,185,129,0.2)]' : 'border-white/10'} text-white font-extrabold text-4xl rounded-2xl px-4 py-4 text-center focus:border-primary-400 focus:outline-none focus:ring-4 focus:ring-primary-500/20 transition-all placeholder-gray-800"
                                    oninput="handleMentorScoreInput(this)">
                                <div class="text-sm text-gray-400 leading-relaxed font-medium border-l border-white/10 pl-6">Human-in-the-loop override.<br>Locks the final Signal Packet.</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            renderProfileRightPanel(c, finalScore, isVal);
        }

        function renderProfileRightPanel(c, finalScore, isVal) {
            document.getElementById('profile-bars').innerHTML = `
                <div class="w-full text-center mb-6 p-8 bg-black/60 rounded-3xl border border-white/5 relative overflow-hidden shadow-inner">
                    <div class="absolute inset-0 bg-gradient-to-t from-primary-500/10 to-transparent ${isVal ? 'opacity-100' : 'opacity-0'} transition-opacity duration-500"></div>
                    <div class="text-sm text-gray-500 uppercase tracking-widest font-bold mb-3 relative z-10">Final Deployability Score</div>
                    <div class="text-[5rem] leading-none font-extrabold ${isVal ? 'text-white text-glow' : 'text-gray-600'} transition-colors duration-500 relative z-10">${finalScore}</div>
                </div>
                <div class="w-full space-y-6">
                    ${createBarHTML('System Thinking Index', c.indices.system_thinking * 100)}
                    ${createBarHTML('Ambiguity Handling Index', c.indices.ambiguity_handling * 100)}
                    ${createBarHTML('Domain Depth Index', c.indices.domain_depth * 100)}
                </div>
            `;

            const apiPacket = {
                object: "signal_packet",
                candidate_id: c.id,
                name: c.name,
                deployability_score: finalScore,
                execution_reliability: c.execution_reliability,
                indices: {
                    system_thinking: c.indices.system_thinking,
                    ambiguity_handling: c.indices.ambiguity_handling,
                    domain_depth: c.indices.domain_depth
                },
                portfolio_validation_status: c.portfolio_validation_status,
                mentor_validated_status: isVal,
                machine_readable: true,
                timestamp: new Date().toISOString()
            };
            document.getElementById('json-code-block').textContent = JSON.stringify(apiPacket, null, 2);

            lucide.createIcons();
            renderRadarChart(c, finalScore);
        }

        function createBarHTML(label, val) {
            let width = Math.min(Math.max(val, 0), 100);
            return `
                <div>
                    <div class="flex justify-between text-xs font-bold uppercase tracking-wider mb-3">
                        <span class="text-gray-300">${label}</span> 
                        <span class="font-mono text-primary-400 text-sm">${Math.round(width)}</span>
                    </div>
                    <div class="w-full bg-white/5 rounded-full h-2 overflow-hidden border border-white/5">
                        <div class="bg-gradient-to-r from-primary-600 to-primary-400 h-full transition-all duration-700 ease-out shadow-[0_0_10px_#10b981]" style="width: ${width}%"></div>
                    </div>
                </div>
            `;
        }

        function renderRadarChart(c, finalScore) {
            const ctx = document.getElementById('skillsRadarChart').getContext('2d');
            if (radarChartInstance) radarChartInstance.destroy();

            const sysT = c.indices.system_thinking * 100;
            const ambH = c.indices.ambiguity_handling * 100;
            const domD = c.indices.domain_depth * 100;
            const menS = c.mentor_score || 0;
            
            const isVal = c.mentor_score !== null;
            const borderColor = isVal ? '#34d399' : '#52525b';
            const bgColor = isVal ? 'rgba(52, 211, 153, 0.15)' : 'rgba(255, 255, 255, 0.05)';

            radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['System', 'Ambiguity', 'Depth', 'AI Base', 'Mentor'],
                    datasets: [{
                        data: [sysT, ambH, domD, c.ai_confidence_score, menS],
                        backgroundColor: bgColor,
                        borderColor: borderColor,
                        borderWidth: 2,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: borderColor,
                        pointRadius: 4,
                        pointHoverRadius: 8,
                        fill: true
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            pointLabels: { color: '#a1a1aa', font: { family: '"Plus Jakarta Sans"', size: 12, weight: 'bold' } },
                            ticks: { display: false, min: 0, max: 100 }
                        }
                    },
                    plugins: { legend: { display: false } },
                    animation: { duration: 600, easing: 'easeOutQuart' }
                }
            });
        }

        // LAYER 5: Hiring Visibility Layer
        function renderAnalytics() {
            const pool = state.analysisData.candidates;
            let totalFinal = 0; let valCount = 0;
            pool.forEach(c => { totalFinal += getFinalScore(c); if(c.mentor_score !== null) valCount++; });
            
            const avgScore = pool.length > 0 ? Math.round(totalFinal / pool.length) : 0;
            const passed = pool.filter(c => getFinalScore(c) >= 80).length;
            const passRate = pool.length > 0 ? Math.round((passed / pool.length) * 100) : 0;

            document.getElementById('analytics-top').innerHTML = `
                <div class="bg-base-950 border border-white/5 rounded-3xl p-10 flex flex-col items-center justify-center text-center shadow-lg">
                    <div class="text-sm text-gray-500 uppercase font-bold tracking-widest mb-4">Validated Pool Access</div>
                    <div class="text-6xl font-extrabold text-white">${pool.length}</div>
                    <div class="text-xs text-primary-400 mt-4 font-mono font-bold bg-primary-500/10 border border-primary-500/20 px-3 py-1 rounded-lg">Zero Noise Pool</div>
                </div>
                <div class="bg-gradient-to-br from-primary-500/20 to-neural-500/10 border border-primary-500/30 rounded-3xl p-10 flex flex-col items-center justify-center text-center shadow-[inset_0_0_30px_rgba(16,185,129,0.1)]">
                    <div class="text-sm text-primary-400 uppercase font-bold tracking-widest mb-4">Signal-First Top Rank</div>
                    <div class="text-6xl font-extrabold text-white text-glow">${passRate}%</div>
                </div>
                <div class="bg-base-950 border border-white/5 rounded-3xl p-10 flex flex-col items-center justify-center text-center shadow-lg">
                    <div class="text-sm text-gray-500 uppercase font-bold tracking-widest mb-4">Avg Platform Matrix</div>
                    <div class="text-6xl font-extrabold text-white">${avgScore}</div>
                </div>
            `;

            document.getElementById('analytics-rationale').innerHTML = pool.map(c => {
                const fScore = getFinalScore(c);
                return `
                <div class="flex items-start gap-5 p-6 rounded-2xl bg-black border border-white/5 hover:border-white/20 transition-colors shadow-sm">
                    <div class="mt-1 ${fScore >= 80 ? 'text-primary-400 bg-primary-500/10 p-2 rounded-lg' : 'text-gray-600 bg-white/5 p-2 rounded-lg'}">
                        <i data-lucide="${fScore >= 80 ? 'check-circle' : 'circle-dashed'}" class="w-6 h-6"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-lg font-bold text-white flex items-center justify-between mb-2">
                            ${c.name} 
                            <span class="text-xs font-bold uppercase tracking-wider px-3 py-1.5 bg-white/5 rounded-md border ${fScore >= 80 ? 'text-primary-400 border-primary-500/30' : 'text-gray-500 border-white/5'}">Signal Score: ${fScore}</span>
                        </div>
                        <div class="text-sm text-gray-400 leading-relaxed">${c.rationale}</div>
                    </div>
                </div>
            `}).join('');
            lucide.createIcons();
        }
    </script>
</body>
</html>
